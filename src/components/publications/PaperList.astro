---
import type { CollectionEntry } from "astro:content";
import PaperCard from "./PaperCard.astro";

interface Props {
  papers: CollectionEntry<"publications">[];
  groupByYear?: boolean;
}

const { papers, groupByYear = true } = Astro.props;

// Group papers by year
const groupedPapers: Record<number, CollectionEntry<"publications">[]> =
  groupByYear
    ? papers.reduce(
        (acc, paper) => {
          const year = paper.data.year;
          if (!acc[year]) acc[year] = [];
          acc[year].push(paper);
          return acc;
        },
        {} as Record<number, CollectionEntry<"publications">[]>
      )
    : {};

const years = Object.keys(groupedPapers)
  .map(Number)
  .sort((a, b) => b - a);
---

{
  groupByYear ? (
    <div class="space-y-12">
      {years.map((year) => (
        <section class="year-group">
          <div class="flex items-center gap-3 mb-6 border-b border-gray-100 pb-2">
            <h2 class="text-2xl font-bold text-primary-900 flex items-center gap-3">
              {year}
            </h2>
            <span class="text-sm font-medium text-primary-700 bg-primary-50 px-2.5 py-0.5 rounded-full">
              {groupedPapers[year].length}
            </span>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {groupedPapers[year].map((paper) => (
              <PaperCard paper={paper} />
            ))}
          </div>
        </section>
      ))}
    </div>
  ) : (
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {papers.map((paper) => (
        <PaperCard paper={paper} />
      ))}
    </div>
  )
}
